Developer Notes.

Towards version 1.0.0
---------------------

- See NONGENERIC_MAYBE.
- Testing is well underway but there is still a lot to be done.
  * Split tests.
  * More functional tests.
  * Square() and Flatten() or Squash().
  * Expand comparison tests (order and equality).
    Structural comparisons w/ structural types.
    https://stackoverflow.com/questions/4968580/why-arent-istructuralequatable-and-istructuralcomparable-generic
  * Maybe<Func<>>
- Check published packages (upgrade, debugging experience). See repos Abc.

Documentation (README)
- A bit of marketing, compare to other option types.
- Struct really? Explain and compare to ValueTuple.
  https://docs.microsoft.com/en-gb/dotnet/csharp/tuples
  http://mustoverride.com/tuples_structs/
  https://docs.microsoft.com/en-us/archive/msdn-magazine/2018/june/csharp-tuple-trouble-why-csharp-tuples-get-to-break-the-guidelines
  https://docs.microsoft.com/en-us/dotnet/fsharp/language-reference/value-options
  https://github.com/fsharp/fslang-design/blob/master/FSharp.Core-4.5.0.0/FS-1057-valueoption.md
- Nullable attributes and notnull constraint.
  It would make a lot of sense to add a notnull constraint on the T of Maybe<T>,
  but it worries me a bit (I need to gain more experience with the new NRT). It
  would allow to warn a user trying to create a Maybe<int?> or a Maybe<string?>.
  https://docs.microsoft.com/en-us/dotnet/csharp/nullable-attributes
  https://devblogs.microsoft.com/dotnet/try-out-nullable-reference-types/
  https://devblogs.microsoft.com/dotnet/nullable-reference-types-in-csharp/
  https://devblogs.microsoft.com/dotnet/embracing-nullable-reference-types/
- https://docs.microsoft.com/en-us/nuget/reference/msbuild-targets


vNEXT
-----

- "Lifted" comparison T w/ Maybe<T>? see also MaybeComparer<T>.
  IEquatable<T> (T == Maybe<T>), IComparable<T> but a bit missleading?
  Add overloads w/ IEqualityComparer<T>?
- More May helpers w/ Span<T>.
- LINQ: optimize, more ops.
  "Monadic" LINQ. Output Maybe<IEnumerable<T>> and LINQ ops.
- Utilities to write code in the ROP style (Railway Oriented Programming).
- Extensions.
- Async (configurable, enumerable).
- Roslyn Analyzer:
  * Of(), Flatten().
  * SelectMany(), ZipWith(), Bind().

Main tasks
- FIXME, TODO and REVIEW within the code.
- XML comments with complete examples.
  https://github.com/dotnet/dotnet-api-docs/wiki
  When done, filter out Abc.Maybe in Directory.Build.targets (NoWarn), and add
  <NoWarn /> in Retail.targets
- Multitargeting:
  * Target net461? Review !NETSTANDARD2.0 in code.
    https://github.com/dotnet/announcements/issues/31
  * .NET Standard 2.1 & .NET Core 3.1 only. Use System.HashCode.
    Use PlatformNotSupportedException for things that could be supported but
    are not actually.
  * How to handle PublicAPI.XXX.txt?
    https://github.com/dotnet/roslyn-analyzers/blob/master/src/PublicApiAnalyzers/PublicApiAnalyzers.Help.md

Other tasks
- Naming tests: explain rules in this doc and fix the tests themselves if necessary.
- Perf tool (LINQ, nulls, iterable).
- Sample code w/ C#, VB and F#.
- BannedApiAnalyzers?
- Deterministic build? Disabled as it seems to conflict with the fact that we
  change the assembly file version and the description on every build.
- SourceLink? Right now, the answer is no as it requires that the customer changes
  a few VS settings. We use embbeded symbols as it seems to work all the time
  (apparently there are situations where a separate pdb can cause problems too);
  one drawback is the increased size of the dll (~8 Ko).
  If we do change our mind, remove AllowedOutputExtensionsInPackageBuildOutputFolder,
  no longer set InformationalVersion (generated by SourceLink?), add
  ContinuousIntegrationBuild.
  https://github.com/NuGet/Home/issues/4142
- Replace coverlet.msbuild by coverlet-console? Use runsettings.
  Add coverlet.collector to the test project. Coverity?
- Publish dev packages to myget or github?
- Cleanup scripts, dotnet nuget locals --clear all.
- Local tools: find updates, dotnet-outdated.
  Remove refs to OpenCover and ReportGenerator in Abc.Tests.
  https://docs.microsoft.com/en-us/dotnet/core/tools/global-tools

Versioning
----------

Format Major.Minor.Patch[-PreRelease]
- Major: Breaking changes -or- Major new features.
- Minor: Minor new features, but backwards compatible.
- Patch: Backwards compatible bug fixes only.
- PreRelease:
  DEV)   Internal, not for public consumption.
         Exist only to prevent accidental publication of a dev package.
  alpha) Used for work-in-progress and experimentation.
  beta)  One that is feature complete for the next planned release, but may
         contain known bugs.
  rc)    A release that's potentially final (stable) unless significant bugs
         emerge.
Regarding new features, we do not follow exactly semantic versioning;
see https://docs.microsoft.com/en-us/nuget/concepts/package-versioning

Under normal circumstances, we do NOT introduce breaking changes, in particular
we do NOT remove features (we mark them as obsolete).
If we have to, this can ONLY happen with a new MAJOR release (not minor), eg
1.3.4 to 2.0.0 is OK, but 1.3.4 to 1.4.0 is NOT.
Pre-releases are free to introduce new features and remove them after; it should
not happen with beta releases but we never know.

Changelog
---------

Sections.
- Added, for new features.
- Changed, for changes in existing functionality.
  Binary breaking changes MUST be prefixed w/ [BREAKING] and appeared first.
  New obsolete methods MUST be prefixed w/ [OBSOLETE] and appear just after.
- Removed, for now removed features. NB: any item appearing here obviously
  introduces a breaking change.
- Fixed, for any bug fixes.
- Security, in case of vulnerabilities.
- Internal Changes, for changes that are of no interest outside the project.

Production releases should have a title and highlight the relevant changes made
during the pre-release phase.

Inspired by https://keepachangelog.com/en/1.0.0/

Release Process
---------------

Requirement: command-line git.

Before a production packages, check that there are no remaining FIXMEs and review
the TODOs and REVIEWs.

Pre action, for beta -or- production packages.
0. Run script eng\freeze-api.ps1, then review the result.
   NB: between releases, feel free to add and remove **new** stuff.

1. New version in eng\Abc.Maybe.props
2. Update CHANGELOG
3. Run script eng\pack.ps1 -n -f
4. Git commit
5. Run script eng\pack.ps1 -c -s
6. Publish package

Post action, for production packages.
6. Git tag

Development
-----------

Rules.
- Seal classes unless they are designed for extensibility.
- Add nullable annotations wherever necessary.
  Tag any use of the null-forgiving operator (!) with BONSANG!.
- Methods that return something should have the attribure Pure. It is not
  mandatory but it clearly states that the result should not be ignored.
  It might seem superfluous, but "Ã§a ne mange pas de pain".
- Good principles worth remembering: The Zen of Python.
  https://www.python.org/dev/peps/pep-0020/

Changes to the default editor config (does not affect the compilation).
- IDE0039 - csharp_style_pattern_local_over_anonymous_function
- IDE0060 - dotnet_code_quality_unused_parameters, (Remove unused parameter) covered by CA1801.
https://docs.microsoft.com/en-us/visualstudio/ide/editorconfig-language-conventions?view=vs-2019

Testing.
- Do not hesitate to test the obvious and to write redundant tests.
- Test what's not supposed to work too, eg misuses.
- Tests should provide samples.
Naming tests and grouping them are here to help us to find the relevant test
cases and, more importantly, spot the missing ones. The only real rule is that
what does a test should be easily understandable from the name.
Anyway, in general, we use the following pattern for unit tests:
- Property or method name, followed by
- Instance, followed by
- Expectation, followed by
- "With" for parameters, followed by
- "For" for generic parameters, followed by
- "When" for specific conditions

Local tools.
- qtest.cmd, quickly run the test suite.
- qperf.cmd, quickly run the perf tool.
- eng\cover.ps1, code coverage script (Coverlet or OpenCover).
- eng\pack.ps1, packing script.
- eng\freeze-api.ps1, update public API files.

Useful tools.
- NuGet Package Explorer
- ILDasm, ILSpy, dotPeek
